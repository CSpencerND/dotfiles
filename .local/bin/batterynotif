#!/usr/bin/env bash

POWER_PATH="/sys/class/power_supply"
AC_FILE="$POWER_PATH/AC/online"
BAT_FILE="$POWER_PATH/BAT0/capacity"
WARNING_SOUND="$HOME/Music/warning-notification.wav"

do_files_exist() {
	if [ ! -f "$AC_FILE" ]; then
		echo "AC power status file not found."
		exit 1
	fi

	if [ ! -f "$BAT_FILE" ]; then
		echo "Battery capacity file not found."
		exit 1
	fi
}

run() {
	while true; do
		ac=$(cat "$AC_FILE")

		if [ "$ac" -eq 1 ]; then
			sleep 8m
			continue
		fi

		bat=$(cat "$BAT_FILE")

		if [ "$bat" -le 34 ]; then
			notify-send -u critical -t 5000 "ðŸ”‹ Plug in the charger!"

			if command -v mpv &>/dev/null && [ -f "$WARNING_SOUND" ]; then
				mpv "$WARNING_SOUND"
			fi
		fi

		sleep 8m
	done
}

main() {
	do_files_exist
	run
}

main
